{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="container pt-4">
    <div class="container">

      <!-- TITLE -->
        <div class="row">
            <div class="row">
                <div class="col-12 mx-auto">
                    <h2 class="text-center">Curriculum "{{curriculum.title}}"</h2>
                </div>
            </div>
        </div>

        <!-- INFO CARD -->
        <div class="row">
            <div class="col-12">
                <div class="row">
                    <div class="card w-100">
                        <div class="card-body">
                          <!-- TITLE INFO CARD -->
                            <div class="card-subtitle">
                                <div class="row">
                                    <div class="col-8">
                                        <h6 class="text-muted text-">This curriculum is part of the subject {{curriculum.subject}}</h6>
                                    </div>
                                    <div class="col-4 text-right">
                                        {% if curriculum.posted_by == current_user %}
                                        <p>Edit
                                        <a href="{% url 'curriculum_update' c_id=curriculum.id %}"
                                            class="far fa-edit"></a></p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <!-- Curriculum Description -->
                            <p class="card-text">{{curriculum.description}}</p>
                            <div class="row">
                                <div class="col-8">
                                    {% if curriculum.is_upvoted %}
                                    <form method="post" class="d-inline"
                                        action="{% url 'curriculum_upvote_delete' c_id=curriculum.id %}">
                                        {% csrf_token %}
                                        <span
                                            class="badge badge-light d-inline">{{ curriculum.upvote.all|length }}</span>
                                        <input class="btn btn-sm btn-secondary" type="submit" value="-1">
                                    </form>
                                    {% else %}
                                    <form method="post" class="d-inline"
                                        action="{% url 'curriculum_upvote_create' c_id=curriculum.id %}">
                                        {% csrf_token %}
                                        <span
                                            class="badge badge-light d-inline">{{ curriculum.upvote.all|length }}</span>
                                        <input class="btn btn-sm btn-secondary" type="submit" value="+1">
                                    </form>
                                    {% endif %}
                                </div>
                                <div class="col-4 text-right">
                                  <!-- SUBSCRIBE BUTTON-->
                                  {% if user_subscription %}
                                  <form class="form-inline d-inline" method="post"
                                      action="{% url 'subscription_delete' sid=user_subscription.id %}">
                                      {% csrf_token %}
                                      <button class="btn btn-sm btn-outline-dark" type="submit">Unsubscribe</button>
                                  </form>
                                  {% else %}
                                  <form class="form-inline d-inline" method="post"
                                      action="{% url 'curriculum_subscription_create' c_id=curriculum.id %}">
                                      {% csrf_token %}
                                      <button class="btn btn-sm btn-outline-dark" type="submit">Subscribe</button>
                                  </form>
                                  {% endif %}
                                  <!-- TEACH BUTTON -->
                                  <form class="form-inline d-inline" method="post">
                                      {% csrf_token %}
                                      <button class="btn btn-sm btn-outline-dark" name="_teach"
                                          type="submit">{{teach_button_status}}</button>
                                  </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-8"> <!-- Discussion & Bits column -->
              <div class="row"> <!-- BITS -->
                <div class="col pl-0 pr-0 pt-4">
                    <div class="row">
                        <div class="col-8 pl-10">
                            <h5 class="d-inline">Bits of Content</h5>
                        </div>
                        <div class="col-4 text-right">
                            <p> Add <a href="{% url 'create_bit' c_id=curriculum.id %}" class="fas fa-plus"></a></p>
                        </div>
                    </div>
                    {% if not curriculum.bit.all  %}
                    <div class="row">
                        <div class="col-12 text-center">
                            <p>This curriculum is currently empty.</p>
                        </div>
                    </div>
                    {% endif %}
                    <div class="accordion pl-20" id="accordionExample">
                        {% for bit in curriculum.bit.all %}
                        {% include "./show/_bit.html" %}
                        {% endfor %}
                    </div>
                </div>
              </div>
              <!-- Discussion -->
              <div class="row">
                <div class="col pl-2 pt-4">
                    <div class="row">
                        <div class="col-12 pl-2">
                            <h5 >Discussion</h5>
                        </div>
                    </div>
                    <div class="row pl-2">
                        <div class="pl-2 card card-body">
                            <ul class="list-group list-group-flush">
                                {% for comment in curriculum.comment.all %}
                                <li class="list-group-item">
                                    <div class="row">
                                        <div class="col-12">
                                            Display Profile Pic + Name
                                        </div>
                                        <div class="col-10">
                                            {{comment.comment}} <br />
                                            {{comment.created_on}}
                                        </div>
                                    </div>
                                </li>
                                {% endfor %}
                                <li class="list-group-item">
                                    <form method="post" action="{% url 'curriculum_comment_create' c_id=curriculum.id %}">
                                        {% csrf_token %}
                                        <input type="text" name="comment" />
                                        <input type="submit" value="Comment">
                                    </form>
                                </li>
                            </ul>

                        </div>
                    </div>
                </div>
              </div>
            </div>
            <div class="col"> <!-- subscribers, contributers column -->
              <div class="row"> <!-- Institution Teaching Block -->
                <div class="col pt-4 pl-sm-4">
                    <div class="row">
                        <div class="col-12">
                            <h5>Institutions Teaching this Curriculum</h5>
                        </div>
                    </div>
                    <div class="row">
                        <div class="card card-body">
                            {% if institutions_teaching %}
                                <ul class="list-group list-group-flush">
                                        {% for Institution in institutions_teaching %}
                                    <li class="list-group-item">
                                        <div class="row">
                                            <div class="col-10">
                                                {{Institution}}
                                            </div>
                                        </div>
                                    </li>
                                    {% endfor %}
                                </ul>
                            {% else%}
                                <b>No Institution is teaching this curriculum as of now.
                                   If you like the curriculum, press teach to acknowledge you are
                                   teaching this curriculum at your institution. </b>
                            {% endif %}
                        </div>
                    </div>
                </div>
              </div>
              <div class="row"> <!-- Subscribed User Block -->
                <div class="col pt-4 pl-sm-4">
                    <div class="row">
                        <div class="col-12">
                            <h5>Subscribers</h5>
                        </div>
                    </div>
                    <div class="row">
                        <div class="card card-body">
                            {% if subscribed_users %}
                                <ul class="list-group list-group-flush">
                                        {% for user in subscribed_users %}
                                    <li class="list-group-item">
                                        <div class="row">
                                            <div class="col-10">
                                                {% if user.image %}
                                                    <img width=35px src="{{user.image.url}}">
                                                {% else %}
                                                    <img width=35px src="/media/avatar.png">
                                                {% endif %}

                                                <a href="{% url 'profile_view' uname=user.u_id %}"> {{user.full_name}}</a>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-10">
                                            </div>
                                        </div>
                                    </li>
                                    {% endfor %}
                                </ul>
                            {% else%}
                            <b>No users are subscribed to this curriculum as of now.
                               Press subscribe button to follow all updates related
                               to this curriculum. </b>
                            {% endif %}
                        </div>
                    </div>
                </div>
              </div>
              <!-- Contributors Block -->
              <div class ="row">
                <div class="col pt-4 pl-sm-4">
                    <div class="row">
                        <div class="col-12">
                            <h5>Contributors</h5>
                        </div>
                    </div>
                    <div class="row">
                        <div class="card card-body">
                            {% if contributors %}
                                <ul class="list-group list-group-flush">
                                        {% for contributor in contributors %}
                                    <li class="list-group-item">
                                        <div class="row">
                                            <div class="col-10">
                                                {% if contributor.image %}
                                                    <img width=35px src="{{user.image.url}}">
                                                {% else %}
                                                    <img width=35px src="/media/avatar.png">
                                                {% endif %}

                                                <a href="{% url 'profile_view' uname=contributor.u_id %}"> {{contributor.full_name}}</a>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-10">
                                            </div>
                                        </div>
                                    </li>
                                    {% endfor %}
                                </ul>
                            {% else%}
                            <b>At the moment there are no contributors for this curriculum.
                               Become one by adding bits to the curriculum or engaging in
                               conversations :) </b>
                            {% endif %}
                        </div>
                    </div>
                  </div>
                </div>
            </div>
        </div>

    </div>
</div>
<script>
    //  subject filter scripts based on field and topic
</script>
{% endblock %}
